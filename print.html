<!DOCTYPE HTML>
<html lang="en" class="light" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title></title>
        <meta name="robots" content="noindex">


        <!-- Custom HTML head -->
        
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        <link rel="stylesheet" href="book.css">

    </head>
    <body class="sidebar-visible no-js">
    <div id="body-container">
        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('light')
            html.classList.add(theme);
            var body = document.querySelector('body');
            body.classList.remove('no-js')
            body.classList.add('js');
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var body = document.querySelector('body');
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            body.classList.remove('sidebar-visible');
            body.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item "><a href="index.html">Home</a></li><li class="chapter-item affix "><li class="part-title">src</li><li class="chapter-item "><a href="src/utils/index.html">‚ù± utils</a><a class="toggle"><div>‚ù±</div></a></li><li><ol class="section"><li class="chapter-item "><a href="src/utils/ECDSA.sol/library.ECDSA.html">ECDSA</a></li><li class="chapter-item "><a href="src/utils/secp256r1.sol/function.pModInv.html">pModInv</a></li><li class="chapter-item "><a href="src/utils/secp256r1.sol/function.nModInv.html">nModInv</a></li><li class="chapter-item "><a href="src/utils/secp256r1.sol/constants.secp256r1.html">secp256r1 constants</a></li></ol></li><li class="chapter-item "><a href="src/ECDSA256r1.sol/library.ECDSA256r1.html">ECDSA256r1</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <!-- Track and set sidebar scroll position -->
        <script>
            var sidebarScrollbox = document.querySelector('#sidebar .sidebar-scrollbox');
            sidebarScrollbox.addEventListener('click', function(e) {
                if (e.target.tagName === 'A') {
                    sessionStorage.setItem('sidebar-scroll', sidebarScrollbox.scrollTop);
                }
            }, { passive: true });
            var sidebarScrollTop = sessionStorage.getItem('sidebar-scroll');
            sessionStorage.removeItem('sidebar-scroll');
            if (sidebarScrollTop) {
                // preserve sidebar scroll position when navigating via links within sidebar
                sidebarScrollbox.scrollTop = sidebarScrollTop;
            } else {
                // scroll sidebar to current active section when navigating via "next/previous chapter" buttons
                var activeSection = document.querySelector('#sidebar .active');
                if (activeSection) {
                    activeSection.scrollIntoView({ block: 'center' });
                }
            }
        </script>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title"></h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/get-smooth/secp256r1-verify" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <blockquote>
<p>‚ùå This repository is deprecated. Please refer to the <a href="https://github.com/get-smooth/CryptoLib">crypto-lib</a> repository
to find the latest implementation of the secp256r1 curve.</p>
</blockquote>
<h1 id="secp256r1-verify"><a class="header" href="#secp256r1-verify">secp256r1 verify</a></h1>
<p><a href="https://github.dev/get-smooth/secp256r1-verify/tree/main"><img src="https://img.shields.io/badge/Github-Open%20the%20Editor-purple?logo=github" alt="Open in Github" /></a> <a href="https://github.com/get-smooth/secp256r1-verify/actions/workflows/quality-checks.yml"><img src="https://github.com/get-smooth/secp256r1-verify/actions/workflows/quality-checks.yml/badge.svg?branch=main" alt="Github Actions" /></a>
<a href="https://github.com/get-smooth/secp256r1-verify/actions/workflows/tests.yml"><img src="https://github.com/get-smooth/secp256r1-verify/actions/workflows/tests.yml/badge.svg?branch=main" alt="Github Actions" /></a>
<a href="https://github.com/get-smooth/secp256r1-verify/actions/workflows/static-analysis.yml"><img src="https://github.com/get-smooth/template-foundry/actions/workflows/static-analysis.yml/badge.svg?branch=main" alt="Github Actions" /></a>
<a href="https://github.com/get-smooth/secp256r1-verify/actions/workflows/release-package.yml"><img src="https://github.com/get-smooth/secp256r1-verify/actions/workflows/release-package.yml/badge.svg" alt="Github Actions" /></a> <a href="https://book.getfoundry.sh/"><img src="https://img.shields.io/badge/Built%20with-Foundry-FFDB1C.svg" alt="Foundry" /></a>
<a href="./LICENSE.html"><img src="https://img.shields.io/badge/License-MIT-blue.svg" alt="License: MIT" /></a> <img src="https://img.shields.io/badge/Audited-No-red.svg" alt="Is it audited?" /></p>
<h2 id="description"><a class="header" href="#description">Description</a></h2>
<p><code>secp256r1-verify</code> is a specialized Solidity library that enables on-chain ECDSA signature verification on the secp256r1
curve with notable efficiency. This repository is a simple implementation for signature verification. It sets a vital
foundation for the widespread application of FIDO2's Webauthn, serving as an authentication protocol for smart accounts.
If you are looking for an alternative implementation, such as the ones based on the <code>*codedopy</code> opcodes, check out
Renaud Dubois' <a href="https://github.com/rdubois-crypto/FreshCryptoLib">FreshCryptoLib</a> repository.</p>
<h2 id="installation"><a class="header" href="#installation">Installation</a></h2>
<h3 id="foundry"><a class="header" href="#foundry">Foundry</a></h3>
<p>To install the <code>secp256r1-verify</code> package in a Foundry project, execute the following command:</p>
<pre><code class="language-sh">forge install https://github.com/get-smooth/secp256r1-verify
</code></pre>
<p>This command will install the latest version of the package in your lib directory. To install a specific version of the
library, follow the instructions in the
<a href="https://book.getfoundry.sh/reference/forge/forge-install?highlight=forge%20install#forge-install">official Foundry documentation</a>.</p>
<h3 id="hardhat-or-truffle"><a class="header" href="#hardhat-or-truffle">Hardhat or Truffle</a></h3>
<p>To install the <code>secp256r1-verify</code> package in a Hardhat or Truffle project, use <code>npm</code> to run the following command:</p>
<pre><code class="language-sh">npm install @smoo.th/secp256r1-verify
</code></pre>
<p>After the installation, import the package into your project and use it.</p>
<h2 id="usage"><a class="header" href="#usage">Usage</a></h2>
<p>This repository provides a unique verification implementation. After you've integrated this library into your project,
you can freely import the <code>ECDSA256r1</code> and use it.</p>
<blockquote>
<p>üö® The implementations have not been audited. DO NOT USE IT IN PRODUCTION.</p>
</blockquote>
<h3 id="1-the-traditional-implementation"><a class="header" href="#1-the-traditional-implementation">1Ô∏è‚É£ The traditional implementation</a></h3>
<p>The traditional approach is the implementation present in this repository. You can take a look to it here:
<a href="./src/ECDSA256r1.sol">ECDSA256r1 file</a>. This implementation is ready to use right out of the box; simply deploy the
library and interact with it by calling its singular exposed function, <code>verify</code>, which accepts three parameters:</p>
<ul>
<li><code>bytes32 messageHash</code>: The hash of the message to verify</li>
<li><code>uint256[2] calldata rs</code>: The r and s values of the ECDSA signature</li>
<li><code>uint256[2] calldata point</code>: The public key point of the signer</li>
</ul>
<p>This approach computes <code>uG + vQ</code> using the Strauss-Shamir's trick on the secp256r1 elliptic curve <strong>on-chain</strong>, where G
is the base point and Q is the public key.</p>
<h3 id="scripts"><a class="header" href="#scripts">Scripts</a></h3>
<p>This repository includes a <a href="./script">script</a> directory containing a set of scripts that can be used to deploy the
different implementations on-chain. Each script contains a set of instructions and an example of how to use it. The
scripts are expected to be run using the <code>forge script</code> command.</p>
<h2 id="gas-reports"><a class="header" href="#gas-reports">Gas reports</a></h2>
<p>These gas reports were produced using the <code>0.8.19</code> version of the Solidity compiler (with 100k optimizer runs),
specifically for the <a href="https://github.com/get-smooth/secp256r1-verify/releases/tag/v0.4.1"><code>0.4.1</code></a> version of the
library. The library version corresponds to commit
<a href="https://github.com/get-smooth/secp256r1-verify/commit/4d0716fc6fd14a92488442e1dd0c18bb2c24ff41">4d0716f</a>.</p>
<blockquote>
<p>‚ÑπÔ∏è If you import the library into your project, we strongly recommend you to enable the optimizer with 100k in order
to have the best gas consumption.</p>
</blockquote>
<h3 id="the-traditional-implementation-"><a class="header" href="#the-traditional-implementation-">The traditional implementation <a href="index.html#1%EF%B8%8F%E2%83%A3-the-traditional-implementation">üîó</a></a></h3>
<div class="table-wrapper"><table><thead><tr><th>Deployment Cost</th><th>Deployment Size</th><th></th><th></th><th></th></tr></thead><tbody>
<tr><td>1002641</td><td>5040</td><td></td><td></td><td></td></tr>
<tr><td>Function Name</td><td>min</td><td>avg</td><td>median</td><td>max</td></tr>
<tr><td>verify</td><td>192620</td><td>202959</td><td>202905</td><td>210079</td></tr>
</tbody></table>
</div>
<h2 id="contributing"><a class="header" href="#contributing">Contributing</a></h2>
<p>To contribute to the project, you must have Foundry and Node.js installed on your system. You can download them from
their official websites:</p>
<ul>
<li>Node.js: https://nodejs.org/</li>
<li>Foundry: https://book.getfoundry.sh/getting-started/installation</li>
</ul>
<blockquote>
<p>‚ÑπÔ∏è We recommend using <a href="https://github.com/nvm-sh/nvm">nvm</a> to manage your Node.js versions. Nvm is a flexible node
version manager that allows you to switch between different versions of Node.js effortlessly. This repository includes
a <code>.nvmrc</code> file at the root of the project. If you have nvm installed, you can run <code>nvm use</code> at the root of the
project to automatically switch to the appropriate version of Node.js.</p>
</blockquote>
<p>Following the installation of Foundry and Node.js, there's an additional dependency called <code>make</code> that needs to be
addressed.</p>
<p><code>make</code> is a build automation tool that employs a file known as a makefile to automate the construction of executable
programs and libraries. The makefile details the process of deriving the target program from the source files and other
dependencies. This allows developers to automate repetitive tasks and manage complex build processes efficiently. <code>make</code>
is our primary tool in a multi-environment repository. It enables us to centralize all commands into a single file
(<a href="./makefile">the makefile</a>), eliminating the need to deal with <code>npm</code> scripts defined in a package.json or remembering
the various commands provided by the <code>foundry</code> cli. If you're unfamiliar with <code>make</code>, you can read more about it
<a href="https://www.gnu.org/software/make/manual/make.html">here</a>.</p>
<p><code>make</code> is automatically included in all modern Linux distributions. If you're using Linux, you should be able to use
<code>make</code> without any additional steps. If not, you can likely find it in the package tool you usually use. MacOS users can
install <code>make</code> using <a href="https://formulae.brew.sh/formula/make">Homebrew</a> with the following command:</p>
<pre><code class="language-sh">brew install make
</code></pre>
<p>At this point, you should have all the required dependencies installed on your system.</p>
<blockquote>
<p>üí° Running make at the root of the project will display a list of all the available commands. This can be useful to
know what you can do</p>
</blockquote>
<h3 id="installing-the-dependencies"><a class="header" href="#installing-the-dependencies">Installing the dependencies</a></h3>
<p>To install the project dependencies, you can run the following command:</p>
<pre><code class="language-sh">make install
</code></pre>
<p>This command will install the forge dependencies in the <code>lib/</code> directory, the npm dependencies in the <code>node_modules</code>
directory and the git hooks defined in the project (<a href="index.html#git-hooks">refer to the Git hooks section</a>s to learn more about
them). These dependencies aren't shipped in production; they're utility dependencies used to build, test, lint, format,
and more, for the project.</p>
<blockquote>
<p>‚ö†Ô∏è This package uses a dependency installed on the Github package registry, meaning you need to authenticate with
GitHub Packages to install it. For more information, refer to the <a href="index.html#setup-github-registry">troubleshooting section</a>.
We're open to deploying it on the npm registry if there's a demand for it. Please open an issue if you'd like to see
this package on the npm registry.</p>
</blockquote>
<p>Next, let's set up the git hooks.</p>
<h3 id="git-hooks"><a class="header" href="#git-hooks">Git hooks</a></h3>
<p>This project uses <code>Lefthook</code> to manage Git hooks, which are scripts that run automatically when certain Git events
occur, such as committing code or pushing changes to a remote repository. <code>Lefthook</code> simplifies the management and
execution of these scripts.</p>
<p>After installing the dependencies, you can configure the Git hooks by running the following command in the project
directory:</p>
<pre><code class="language-sh">make hooks-i
</code></pre>
<p>This command installs a Git hook that runs Lefthook before pushing code to a remote repository. If Lefthook fails, the
push is aborted.</p>
<p>If you wish to run Lefthook manually, you can use the following command:</p>
<pre><code class="language-sh">make hooks
</code></pre>
<p>This will run all the Git hooks defined in the <a href="./lefthook.yml">lefthook</a> file.</p>
<h4 id="skipping-git-hooks"><a class="header" href="#skipping-git-hooks">Skipping git hooks</a></h4>
<p>Should you need to intentionally skip Lefthook, you can pass the <code>--no-verify</code> flag to the git push command. To bypass
Lefthook when pushing code, use the following command:</p>
<pre><code class="language-sh">git push origin --no-verify
</code></pre>
<h2 id="testing"><a class="header" href="#testing">Testing</a></h2>
<h3 id="unit-tests"><a class="header" href="#unit-tests">Unit tests</a></h3>
<p>The unit tests are stored in the <code>test</code> directory. They test individual functions of the package in isolation. These
tests are automatically run by GitHub Actions with every push to the <code>main</code> branch and on every pull request targeting
this branch. They are also automatically run by the git hook on every push to a remote repository if you have installed
it (<a href="index.html#git-hooks">refer to the Git hooks section</a>). Alternatively, you can run them locally by executing the following
command in the project directory:</p>
<pre><code class="language-sh">make test
</code></pre>
<blockquote>
<p>‚ÑπÔ∏è By adding the sufix <code>-v</code> the test command will run in verbose mode, displaying valuable output for debugging.</p>
</blockquote>
<p>For your information, these tests are written using <a href="https://book.getfoundry.sh/forge/tests">forge</a>, and some employ the
property-based testing pattern <em>(fuzzing)</em> to generate random inputs for the functions under test.</p>
<p>Additionally, some test fixtures have been generated using <a href="https://github.com/google/wycheproof">Google's wycheproof</a>
project, which tests crypto libraries against known attacks. These fixtures are located in the
<a href="./test/fixtures">fixtures</a> directory.</p>
<p>The tests use two different <code>cheatcodes</code> you should be aware of:</p>
<ul>
<li><code>vm.readFile</code>: This cheatcode lets us read the fixtures data from the test/fixtures directory. This means that every
time you run the test suite, the fixtures are read from the disk, eliminating the need to copy/paste the fixtures into
the test files. However, if you modify a fixture, you need to rerun the tests to see the changes. More information is
available <a href="https://book.getfoundry.sh/cheatcodes/fs?highlight=readFile">here</a>.</li>
<li><code>vm.ffi</code>: This cheatcode allows us to execute an arbitrary command during the test suite. This cheatcode is not
enabled by default when creating a new foundry project, but in our case, it's enabled in our configuration
(<a href="./foundry.toml">foundry configuration</a>) for all tests. This cheatcode is used to run the computation library that
calculates 256 points on the secp256r1 elliptic curve from a public key. This is required for the variants that need
these points to be deployed on-chain. Therefore, even if it's not explicit, every time you run the test suite, a
Node.js script is executed multiple times. You can learn more about the library we use
<a href="https://github.com/get-smooth/secp256r1-computation">here</a>.</li>
</ul>
<blockquote>
<p>üìñ Cheatcodes are special instructions exposed by Foundry to enhance the developer experience. Learn more about them
<a href="https://book.getfoundry.sh/cheatcodes/">here</a>.</p>
</blockquote>
<blockquote>
<p>üí° Run <code>make</code> to learn how to run the test in verbose mode, or to display the coverage or the gas consumption.</p>
</blockquote>
<h3 id="quality"><a class="header" href="#quality">Quality</a></h3>
<p>This repository uses <code>forge-fmt</code>, <code>solhint</code> and <code>prettier</code> to enforce code quality. These tools are automatically run by
the GitHub Actions on every push to the <code>main</code> branch and on every pull request targeting this branch. They are also
automatically run by the git hook on every push to a remote repository if you have installed it
(<a href="index.html#git-hooks">refer to the Git hooks section</a>). Alternatively, you can run them locally by executing the following
command in the project directory:</p>
<pre><code class="language-sh">make lint # run the linter
make format # run the formatter
make quality # run both
</code></pre>
<blockquote>
<p>‚ÑπÔ∏è By adding the sufix <code>-fix</code> the linter and the formatter will try to fix the issues automatically.</p>
</blockquote>
<h2 id="acknowledgements"><a class="header" href="#acknowledgements">Acknowledgements</a></h2>
<p>Special thanks to <a href="https://github.com/rdubois-crypto">rdubois-crypto</a> for developing the reference implementation
<a href="https://github.com/rdubois-crypto/FreshCryptoLib">here</a> and for the invaluable cryptographic guidance. The
implementation, and more precisely, all the ingenious mathematical tricks you can discover in this repository, are from
his mind. My role here was to clean up his work to improve the chances of accepting contributions. All credit goes to
him.</p>
<p>If you want to learn more about the math behind this project, check out
<a href="https://eprint.iacr.org/2023/939.pdf">this publication</a> written by
<a href="https://twitter.com/RenaudDUBOIS10">rdubois-crypto</a>.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="contents"><a class="header" href="#contents">Contents</a></h1>
<ul>
<li><a href="src/utils/ECDSA.sol/library.ECDSA.html">ECDSA</a></li>
<li><a href="src/utils/secp256r1.sol/function.pModInv.html">pModInv</a></li>
<li><a href="src/utils/secp256r1.sol/function.nModInv.html">nModInv</a></li>
<li><a href="src/utils/secp256r1.sol/constants.secp256r1.html">secp256r1 constants</a></li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="ecdsa"><a class="header" href="#ecdsa">ECDSA</a></h1>
<p><a href="https://github.com/get-smooth/secp256r1-verify/blob/62a9b6b73a0f131f8fc8fbc2e8fe4c35c0ebb8df/src/utils/ECDSA.sol">Git Source</a></p>
<p>Library for handling Elliptic Curve Digital Signature Algorithm (ECDSA) operations on a compatible curve</p>
<h2 id="functions"><a class="header" href="#functions">Functions</a></h2>
<h3 id="zz2aff"><a class="header" href="#zz2aff">zz2Aff</a></h3>
<p>Convert from XYZZ coordinates to affine coordinates
Learn more about the XYZZ representation here:
https://hyperelliptic.org/EFD/g1p/auto-shortw-xyzz-3.html#addition-add-2008-s*</p>
<pre><code class="language-solidity">function zz2Aff(uint256 x, uint256 y, uint256 zz, uint256 zzz) internal returns (uint256 x1, uint256 y1);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>x</code></td><td><code>uint256</code></td><td>The X-coordinate of the point in XYZZ representation</td></tr>
<tr><td><code>y</code></td><td><code>uint256</code></td><td>The Y-coordinate of the point in XYZZ representation</td></tr>
<tr><td><code>zz</code></td><td><code>uint256</code></td><td>The ZZ value of the point in XYZZ representation</td></tr>
<tr><td><code>zzz</code></td><td><code>uint256</code></td><td>The ZZZ value of the point in XYZZ representation</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>x1</code></td><td><code>uint256</code></td><td>The X-coordinate of the point in affine representation</td></tr>
<tr><td><code>y1</code></td><td><code>uint256</code></td><td>The Y-coordinate of the point in affine representation</td></tr>
</tbody></table>
</div>
<h3 id="zzaddn"><a class="header" href="#zzaddn">zzAddN</a></h3>
<p>Adds a point in XYZZ coordinates to a point in affine coordinates</p>
<pre><code class="language-solidity">function zzAddN(
    uint256 x1,
    uint256 y1,
    uint256 zz1,
    uint256 zzz1,
    uint256 x2,
    uint256 y2
)
    internal
    pure
    returns (uint256 P0, uint256 P1, uint256 P2, uint256 P3);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>x1</code></td><td><code>uint256</code></td><td>The X-coordinate of the first point</td></tr>
<tr><td><code>y1</code></td><td><code>uint256</code></td><td>The Y-coordinate of the first point</td></tr>
<tr><td><code>zz1</code></td><td><code>uint256</code></td><td>The ZZ value of the first point</td></tr>
<tr><td><code>zzz1</code></td><td><code>uint256</code></td><td>The ZZZ value of the first point</td></tr>
<tr><td><code>x2</code></td><td><code>uint256</code></td><td>The X-coordinate of the second point</td></tr>
<tr><td><code>y2</code></td><td><code>uint256</code></td><td>The Y-coordinate of the second point</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>P0</code></td><td><code>uint256</code></td><td>The X-coordinate of the resulting point</td></tr>
<tr><td><code>P1</code></td><td><code>uint256</code></td><td>The Y-coordinate of the resulting point</td></tr>
<tr><td><code>P2</code></td><td><code>uint256</code></td><td>The ZZ value of the resulting point</td></tr>
<tr><td><code>P3</code></td><td><code>uint256</code></td><td>The ZZZ value of the resulting point</td></tr>
</tbody></table>
</div>
<h3 id="zzdouble"><a class="header" href="#zzdouble">zzDouble</a></h3>
<p>Performs point doubling operation in XYZZ coordinates on an elliptic curve</p>
<p><em>This implements the "dbl-2008-s-1" doubling formulas from Sutherland's 2008 paper</em></p>
<pre><code class="language-solidity">function zzDouble(
    uint256 x,
    uint256 y,
    uint256 zz,
    uint256 zzz
)
    internal
    pure
    returns (uint256 P0, uint256 P1, uint256 P2, uint256 P3);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>x</code></td><td><code>uint256</code></td><td>The X-coordinate of the point</td></tr>
<tr><td><code>y</code></td><td><code>uint256</code></td><td>The Y-coordinate of the point</td></tr>
<tr><td><code>zz</code></td><td><code>uint256</code></td><td>The ZZ value of the point</td></tr>
<tr><td><code>zzz</code></td><td><code>uint256</code></td><td>The ZZZ value of the point</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>P0</code></td><td><code>uint256</code></td><td>The X-coordinate of the resulting point after doubling</td></tr>
<tr><td><code>P1</code></td><td><code>uint256</code></td><td>The Y-coordinate of the resulting point after doubling</td></tr>
<tr><td><code>P2</code></td><td><code>uint256</code></td><td>The ZZ value of the resulting point after doubling</td></tr>
<tr><td><code>P3</code></td><td><code>uint256</code></td><td>The ZZZ value of the resulting point after doubling</td></tr>
</tbody></table>
</div>
<h3 id="affisoncurve"><a class="header" href="#affisoncurve">affIsOnCurve</a></h3>
<p>Check if a point in affine coordinates is on the curve</p>
<pre><code class="language-solidity">function affIsOnCurve(uint256 x, uint256 y) internal pure returns (bool);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>x</code></td><td><code>uint256</code></td><td>The X-coordinate of the point</td></tr>
<tr><td><code>y</code></td><td><code>uint256</code></td><td>The Y-coordinate of the point</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>bool</code></td><td>bool True if the point is on the curve, false otherwise</td></tr>
</tbody></table>
</div>
<h3 id="affadd"><a class="header" href="#affadd">affAdd</a></h3>
<p>Add two points on the elliptic curve in affine coordinates</p>
<pre><code class="language-solidity">function affAdd(uint256 x0, uint256 y0, uint256 x1, uint256 y1) internal returns (uint256 x2, uint256 y2);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>x0</code></td><td><code>uint256</code></td><td>The X-coordinate of the first point</td></tr>
<tr><td><code>y0</code></td><td><code>uint256</code></td><td>The Y-coordinate of the first point</td></tr>
<tr><td><code>x1</code></td><td><code>uint256</code></td><td>The X-coordinate of the second point</td></tr>
<tr><td><code>y1</code></td><td><code>uint256</code></td><td>The Y-coordinate of the second point</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>x2</code></td><td><code>uint256</code></td><td>The X-coordinate of the resulting point</td></tr>
<tr><td><code>y2</code></td><td><code>uint256</code></td><td>The Y-coordinate of the resulting point</td></tr>
</tbody></table>
</div><div style="break-before: page; page-break-before: always;"></div><h1 id="pmodinv"><a class="header" href="#pmodinv">pModInv</a></h1>
<p><a href="https://github.com/get-smooth/secp256r1-verify/blob/62a9b6b73a0f131f8fc8fbc2e8fe4c35c0ebb8df/src/utils/secp256r1.sol">Git Source</a></p>
<p>Calculate the modular inverse of a given integer, which is the inverse of this integer modulo p.</p>
<p><em>Uses the ModExp precompiled contract at address 0x05 for fast computation using little Fermat theorem</em></p>
<pre><code class="language-solidity">function pModInv(uint256 self) returns (uint256 result);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>self</code></td><td><code>uint256</code></td><td>The integer of which to find the modular inverse</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>result</code></td><td><code>uint256</code></td><td>The modular inverse of the input integer. If the modular inverse doesn't exist, it revert the tx</td></tr>
</tbody></table>
</div><div style="break-before: page; page-break-before: always;"></div><h1 id="nmodinv"><a class="header" href="#nmodinv">nModInv</a></h1>
<p><a href="https://github.com/get-smooth/secp256r1-verify/blob/62a9b6b73a0f131f8fc8fbc2e8fe4c35c0ebb8df/src/utils/secp256r1.sol">Git Source</a></p>
<p>Calculate the modular inverse of a given integer, which is the inverse of this integer modulo n.</p>
<p><em>Uses the ModExp precompiled contract at address 0x05 for fast computation using little Fermat theorem</em></p>
<pre><code class="language-solidity">function nModInv(uint256 self) returns (uint256 result);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>self</code></td><td><code>uint256</code></td><td>The integer of which to find the modular inverse</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>result</code></td><td><code>uint256</code></td><td>The modular inverse of the input integer. If the modular inverse doesn't exist, it revert the tx</td></tr>
</tbody></table>
</div><div style="break-before: page; page-break-before: always;"></div><h1 id="constants"><a class="header" href="#constants">Constants</a></h1>
<p><a href="https://github.com/get-smooth/secp256r1-verify/blob/62a9b6b73a0f131f8fc8fbc2e8fe4c35c0ebb8df/src/utils/secp256r1.sol">Git Source</a></p>
<h3 id="p"><a class="header" href="#p">p</a></h3>
<pre><code class="language-solidity">uint256 constant p = 0xFFFFFFFF00000001000000000000000000000000FFFFFFFFFFFFFFFFFFFFFFFF;
</code></pre>
<h3 id="a"><a class="header" href="#a">a</a></h3>
<pre><code class="language-solidity">uint256 constant a = 0xFFFFFFFF00000001000000000000000000000000FFFFFFFFFFFFFFFFFFFFFFFC;
</code></pre>
<h3 id="b"><a class="header" href="#b">b</a></h3>
<pre><code class="language-solidity">uint256 constant b = 0x5AC635D8AA3A93E7B3EBBD55769886BC651D06B0CC53B0F63BCE3C3E27D2604B;
</code></pre>
<h3 id="gx"><a class="header" href="#gx">gx</a></h3>
<pre><code class="language-solidity">uint256 constant gx = 0x6B17D1F2E12C4247F8BCE6E563A440F277037D812DEB33A0F4A13945D898C296;
</code></pre>
<h3 id="gy"><a class="header" href="#gy">gy</a></h3>
<pre><code class="language-solidity">uint256 constant gy = 0x4FE342E2FE1A7F9B8EE7EB4A7C0F9E162BCE33576B315ECECBB6406837BF51F5;
</code></pre>
<h3 id="n"><a class="header" href="#n">n</a></h3>
<pre><code class="language-solidity">uint256 constant n = 0xFFFFFFFF00000000FFFFFFFFFFFFFFFFBCE6FAADA7179E84F3B9CAC2FC632551;
</code></pre>
<h3 id="minus_2"><a class="header" href="#minus_2">MINUS_2</a></h3>
<pre><code class="language-solidity">uint256 constant MINUS_2 = 0xFFFFFFFF00000001000000000000000000000000FFFFFFFFFFFFFFFFFFFFFFFD;
</code></pre>
<h3 id="minus_2modn"><a class="header" href="#minus_2modn">MINUS_2MODN</a></h3>
<pre><code class="language-solidity">uint256 constant MINUS_2MODN = 0xFFFFFFFF00000000FFFFFFFFFFFFFFFFBCE6FAADA7179E84F3B9CAC2FC63254F;
</code></pre>
<h3 id="minus_1"><a class="header" href="#minus_1">MINUS_1</a></h3>
<pre><code class="language-solidity">uint256 constant MINUS_1 = 0xFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF;
</code></pre>
<h3 id="modexp_precompile"><a class="header" href="#modexp_precompile">MODEXP_PRECOMPILE</a></h3>
<pre><code class="language-solidity">address constant MODEXP_PRECOMPILE = 0x0000000000000000000000000000000000000005;
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="ecdsa256r1"><a class="header" href="#ecdsa256r1">ECDSA256r1</a></h1>
<p><a href="https://github.com/get-smooth/secp256r1-verify/blob/62a9b6b73a0f131f8fc8fbc2e8fe4c35c0ebb8df/src/ECDSA256r1.sol">Git Source</a></p>
<p>A library to verify ECDSA signatures made on the secp256r1 curve</p>
<p><em>This is the easiest library to deal with but also the most expensive in terms of gas cost. Indeed, this library
must calculate multiple points on the curve in order to verify the signature. Use it kmowingly.</em></p>
<h2 id="functions-1"><a class="header" href="#functions-1">Functions</a></h2>
<h3 id="ispointvalid"><a class="header" href="#ispointvalid">isPointValid</a></h3>
<p>Verifies that a point is on the secp256r1 curve</p>
<pre><code class="language-solidity">function isPointValid(uint256 x, uint256 y) internal pure returns (bool);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>x</code></td><td><code>uint256</code></td><td>The x-coordinate of the point</td></tr>
<tr><td><code>y</code></td><td><code>uint256</code></td><td>The y-coordinate of the point</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>bool</code></td><td>bool True if the point is on the curve, false otherwise</td></tr>
</tbody></table>
</div>
<h3 id="mulmuladd"><a class="header" href="#mulmuladd">mulmuladd</a></h3>
<p>and Q is the public key.</p>
<pre><code class="language-solidity">function mulmuladd(uint256 Q0, uint256 Q1, uint256 scalar_u, uint256 scalar_v) internal returns (uint256 X);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>Q0</code></td><td><code>uint256</code></td><td>x-coordinate of the input point Q</td></tr>
<tr><td><code>Q1</code></td><td><code>uint256</code></td><td>y-coordinate of the input point Q</td></tr>
<tr><td><code>scalar_u</code></td><td><code>uint256</code></td><td>Multiplier for basepoint G</td></tr>
<tr><td><code>scalar_v</code></td><td><code>uint256</code></td><td>Multiplier for input point Q</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>X</code></td><td><code>uint256</code></td><td>Resulting x-coordinate of the computed point</td></tr>
</tbody></table>
</div>
<h3 id="verify"><a class="header" href="#verify">verify</a></h3>
<p>Verifies an ECDSA signature on the secp256r1 curve given the message, signature, and public key.
This function is the only one exposed by the library</p>
<p><em>Note the required interactions with the precompled contract can revert the transaction</em></p>
<pre><code class="language-solidity">function verify(bytes32 message, uint256 r, uint256 s, uint256 qx, uint256 qy) internal returns (bool);
</code></pre>
<p><strong>Parameters</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>message</code></td><td><code>bytes32</code></td><td>The original message that was signed</td></tr>
<tr><td><code>r</code></td><td><code>uint256</code></td><td>uint256 The r value of the ECDSA signature.</td></tr>
<tr><td><code>s</code></td><td><code>uint256</code></td><td>uint256 The s value of the ECDSA signature.</td></tr>
<tr><td><code>qx</code></td><td><code>uint256</code></td><td>The x value of the public key used for the signature</td></tr>
<tr><td><code>qy</code></td><td><code>uint256</code></td><td>The y value of the public key used for the signature</td></tr>
</tbody></table>
</div>
<p><strong>Returns</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Name</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>&lt;none&gt;</code></td><td><code>bool</code></td><td>bool True if the signature is valid, false otherwise</td></tr>
</tbody></table>
</div>
                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->


                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">

            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr.min.js"></script>
        <script src="mark.min.js"></script>
        <script src="searcher.js"></script>

        <script src="clipboard.min.js"></script>
        <script src="highlight.js"></script>
        <script src="book.js"></script>

        <!-- Custom JS scripts -->
        <script src="solidity.min.js"></script>

        <script>
        window.addEventListener('load', function() {
            window.setTimeout(window.print, 100);
        });
        </script>

    </div>
    </body>
</html>
